#pragma once
#include <cstdint>
#include <vector>
#include <string>
#include <cctype>

// 5x7 bitmap font for ASCII 32..90 (space to 'Z'); other chars map to '?'
// Each entry has 7 rows, each row uses lower 5 bits.
static const uint8_t FONT5x7[59][7] = {
/* 32 ' ' */ {0,0,0,0,0,0,0},
/* 33 '!' */ {0x04,0x04,0x04,0x04,0x00,0x04,0x00},
/* 34 '"'*/ {0x0A,0x0A,0x00,0x00,0x00,0x00,0x00},
/* 35 '#' */ {0x0A,0x1F,0x0A,0x0A,0x1F,0x0A,0x00},
/* 36 '$' */ {0x04,0x0F,0x14,0x0E,0x05,0x1E,0x04},
/* 37 '%' */ {0x18,0x19,0x02,0x04,0x08,0x13,0x03},
/* 38 '&' */ {0x0C,0x12,0x14,0x08,0x15,0x12,0x0D},
/* 39 '\''*/ {0x06,0x04,0x08,0x00,0x00,0x00,0x00},
/* 40 '(' */ {0x02,0x04,0x08,0x08,0x08,0x04,0x02},
/* 41 ')' */ {0x08,0x04,0x02,0x02,0x02,0x04,0x08},
/* 42 '*' */ {0x00,0x04,0x15,0x0E,0x15,0x04,0x00},
/* 43 '+' */ {0x00,0x04,0x04,0x1F,0x04,0x04,0x00},
/* 44 ',' */ {0x00,0x00,0x00,0x00,0x06,0x04,0x08},
/* 45 '-' */ {0x00,0x00,0x00,0x1F,0x00,0x00,0x00},
/* 46 '.' */ {0x00,0x00,0x00,0x00,0x00,0x0C,0x0C},
/* 47 '/' */ {0x01,0x01,0x02,0x04,0x08,0x10,0x10},
/* 48 '0' */ {0x0E,0x11,0x13,0x15,0x19,0x11,0x0E},
/* 49 '1' */ {0x04,0x0C,0x04,0x04,0x04,0x04,0x0E},
/* 50 '2' */ {0x0E,0x11,0x01,0x06,0x08,0x10,0x1F},
/* 51 '3' */ {0x1F,0x01,0x02,0x06,0x01,0x11,0x0E},
/* 52 '4' */ {0x02,0x06,0x0A,0x12,0x1F,0x02,0x02},
/* 53 '5' */ {0x1F,0x10,0x1E,0x01,0x01,0x11,0x0E},
/* 54 '6' */ {0x06,0x08,0x10,0x1E,0x11,0x11,0x0E},
/* 55 '7' */ {0x1F,0x01,0x02,0x04,0x08,0x08,0x08},
/* 56 '8' */ {0x0E,0x11,0x11,0x0E,0x11,0x11,0x0E},
/* 57 '9' */ {0x0E,0x11,0x11,0x0F,0x01,0x02,0x0C},
/* 58 ':' */ {0x00,0x0C,0x0C,0x00,0x0C,0x0C,0x00},
/* 59 ';' */ {0x00,0x0C,0x0C,0x00,0x0C,0x04,0x08},
/* 60 '<' */ {0x02,0x04,0x08,0x10,0x08,0x04,0x02},
/* 61 '=' */ {0x00,0x1F,0x00,0x00,0x1F,0x00,0x00},
/* 62 '>' */ {0x08,0x04,0x02,0x01,0x02,0x04,0x08},
/* 63 '?' */ {0x0E,0x11,0x01,0x02,0x04,0x00,0x04},
/* 64 '@' */ {0x0E,0x11,0x17,0x15,0x17,0x10,0x0F},
/* 65 'A' */ {0x0E,0x11,0x11,0x1F,0x11,0x11,0x11},
/* 66 'B' */ {0x1E,0x11,0x11,0x1E,0x11,0x11,0x1E},
/* 67 'C' */ {0x0E,0x11,0x10,0x10,0x10,0x11,0x0E},
/* 68 'D' */ {0x1C,0x12,0x11,0x11,0x11,0x12,0x1C},
/* 69 'E' */ {0x1F,0x10,0x10,0x1E,0x10,0x10,0x1F},
/* 70 'F' */ {0x1F,0x10,0x10,0x1E,0x10,0x10,0x10},
/* 71 'G' */ {0x0E,0x11,0x10,0x17,0x11,0x11,0x0F},
/* 72 'H' */ {0x11,0x11,0x11,0x1F,0x11,0x11,0x11},
/* 73 'I' */ {0x0E,0x04,0x04,0x04,0x04,0x04,0x0E},
/* 74 'J' */ {0x1F,0x01,0x01,0x01,0x01,0x11,0x0E},
/* 75 'K' */ {0x11,0x12,0x14,0x18,0x14,0x12,0x11},
/* 76 'L' */ {0x10,0x10,0x10,0x10,0x10,0x10,0x1F},
/* 77 'M' */ {0x11,0x1B,0x15,0x11,0x11,0x11,0x11},
/* 78 'N' */ {0x11,0x19,0x15,0x13,0x11,0x11,0x11},
/* 79 'O' */ {0x0E,0x11,0x11,0x11,0x11,0x11,0x0E},
/* 80 'P' */ {0x1E,0x11,0x11,0x1E,0x10,0x10,0x10},
/* 81 'Q' */ {0x0E,0x11,0x11,0x11,0x15,0x12,0x0D},
/* 82 'R' */ {0x1E,0x11,0x11,0x1E,0x14,0x12,0x11},
/* 83 'S' */ {0x0F,0x10,0x10,0x0E,0x01,0x01,0x1E},
/* 84 'T' */ {0x1F,0x04,0x04,0x04,0x04,0x04,0x04},
/* 85 'U' */ {0x11,0x11,0x11,0x11,0x11,0x11,0x0E},
/* 86 'V' */ {0x11,0x11,0x11,0x11,0x11,0x0A,0x04},
/* 87 'W' */ {0x11,0x11,0x11,0x11,0x15,0x1B,0x11},
/* 88 'X' */ {0x11,0x11,0x0A,0x04,0x0A,0x11,0x11},
/* 89 'Y' */ {0x11,0x11,0x11,0x0A,0x04,0x04,0x04},
/* 90 'Z' */ {0x1F,0x01,0x02,0x04,0x08,0x10,0x1F},
};

inline const uint8_t* font5x7_lookup(char c) {
    if (c < 32 || c > 90) return FONT5x7[63 - 32]; // '?'
    return FONT5x7[c - 32];
}

inline void font5x7_render(const std::string &text, uint32_t color_rgba, std::vector<uint8_t> &out, uint32_t &w, uint32_t &h)
{
    std::string up;
    up.reserve(text.size());
    for (char c : text) up.push_back((char)std::toupper((unsigned char)c));

    const int char_w = 5;
    const int char_h = 7;
    const int spacing = 1;
    w = (uint32_t)(up.size() * (char_w + spacing));
    if (w == 0) w = 1;
    h = (uint32_t)char_h;
    out.assign(w * h * 4, 0);

    uint8_t r = (color_rgba >> 24) & 0xFF;
    uint8_t g = (color_rgba >> 16) & 0xFF;
    uint8_t b = (color_rgba >> 8) & 0xFF;
    uint8_t a = color_rgba & 0xFF;

    int x_cursor = 0;
    for (char c : up) {
        const uint8_t *glyph = font5x7_lookup(c);
        for (int row = 0; row < char_h; ++row) {
            uint8_t bits = glyph[row];
            for (int col = 0; col < char_w; ++col) {
                if (bits & (1 << (char_w - 1 - col))) {
                    uint32_t idx = ((row * (int)w) + x_cursor + col) * 4;
                    out[idx + 0] = r;
                    out[idx + 1] = g;
                    out[idx + 2] = b;
                    out[idx + 3] = a;
                }
            }
        }
        x_cursor += char_w + spacing;
    }
}
